<!DOCTYPE HTML>
<html>

<!--
The MIT License

Copyright (c) 2008-2011 AlteredQualia

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

Contributions:

2008-12-26 - Fritz Webering - added Gaussian mutations
2008-12-16 - Martin Breidt  - updated to export SVG data from DNA

-->

<head>
<title>Image evolution</title>

<style>
aaa { outline:dotted 1px red }
body { font-family:arial, sans-serif; padding:1em }
h2 { margin-top:1.75em }
canvas { border:solid 1px #000 }
.image { float:left; margin:0 0.5em 0 0; font-size:2em }
.clr { clear:both }
ul { list-style-type:square }
a:hover { background:#1e4881; color:white; text-decoration:none }

#algo, #dnaformat { background:#eee; padding:1em; margin-top:1em; border-left:solid 10px #999 }

.snapshot ul, .snapshot img { float:left }
.snapshot ul { margin:0 1em 1.5em 0; color:#333; width:13em }
.wide ul { width:30em }

#fitwrap { font-weight:bold; font-size:1em; color:#999; margin:2em 1em 0 0; float:left; width:15em }
#fitness, #step_benefit, #step_total { font-size:2em;}
#fitness { color:#000; }
#step_benefit { color:#0a0; }
#step_total { color:#aa0; }

#stats { font-size:0.8em; color:#aaa; float:left; position:relative; top:3em; margin-top:-2em }
#time { color:#a00 }
#mutsec { color:#a80 }

#start, #stop { width:4em; margin-top:0.5em; padding:0.5em; background:black; text-align:center; float:left; cursor:pointer; font-size:2em }
#start { color:lightgreen; }
#stop { color:red; display:none }

#imgform { float:left; border:solid 0px #000; padding:0em; margin:0.5em 1em 0 0; width:40em }
#imgurl { width:35em }

.button { background:#000; color:#fff; cursor:pointer; width:3em; padding:0.2em 0.5em 0.2em 0.5em; text-align:center; display:inline }
.button:hover { background:#a00; color:white }
.warning { color:red }
.highlighted { color:yellow }

#dnaformwrap { padding:0; float:left; margin:1em 1em 0 0; }
#clipboard { width:50em; height:13em; margin:1em 0 0 0 }

#mutationtype, #resetdna { margin:0 0 0.4em 0 }
#parameters { float:left; margin:2em 0 0 0 }
.parname { margin:0 0 0.2em 0 }

#geometry { margin:1em 0 0.4em 0 }
#polygons, #vertices { font-size:2em }
.pargeo { margin:0 0 0 0.5em; position:relative; top:0.4em }
#geometry .button { font-weight:bold; width:1em;  }

dt { font-weight:bold; margin-bottom:0.5em }
dd { margin:0 0 2em 0 }

.speed { font-size:0.9em; color:#60BF5F }
</style>

<script src="js/main.js">
</script>

<body onload="init()">
    <div class="image">
        Original<br/>
        <canvas id="canvas_input"></canvas>
    </div>

    <div class="image">
        Best<br/>
        <canvas id="canvas_best"></canvas>
    </div>

    <div class="image">
        Evolving<br/>
        <canvas id="canvas_test"></canvas>
    </div>

    <div id="fitwrap">
        <span id="fitness">?</span> Fitness<br/>
        <span id="step_benefit">0</span> Improvements<br/>
        <span id="step_total">0</span> Mutations<br/>

        <div id="start" onclick="start()">Start</div>
        <div id="stop" onclick="stop()">Stop</div>

        <div id="stats">
            <span id="time">0</span> Elapsed time<br/>
            <span id="mutsec">?</span> Mutations per second<br/>
        </div>
    </div>

    <br class="clr"/>

    <div id="imgform">
        <form>
            <div class="button" id="b_setimage" onclick="set_image()">Set new image URL</div>
            <input id="imgurl"></input>
        </form>
        <small style="color:#555;">Image should be small (~200x200 pixels), otherwise fitness computation is very slow.
        <p>Examples:
        <a onclick="set_example_image(this); return false;" href="img/mona_lisa_crop.jpg">Mona Lisa</a>
        <a onclick="set_example_image(this); return false;" href="img/darwin_crop.jpg">Darwin</a>
        <a onclick="set_example_image(this); return false;" href="img/velociraptor2_crop.jpg">Velociraptor</a>
        <a onclick="set_example_image(this); return false;" href="img/koza_crop.jpg">John Koza</a>
        </small>
    </div>

    <br class="clr"/>

    <div id="dnaformwrap">
        <form name="dnaform">
            <div class="button" id="b_export_dna" onclick="export_dna()">Export DNA</div>
            <div class="button" id="b_export_svg" onclick="export_dna_as_svg()">Export SVG</div>
            <div class="button" id="b_import_dna" onclick="import_dna()">Import DNA</div>
            <a href="#export_note">[help]</a>
            <br/>
            <textarea name="clipboard" id="clipboard" onClick="select_all();"></textarea>
        </form>
    </div>


    <div id="parameters">
        <div id="mutationtype">
            <div class="parname">Mutation</div>
            <div class="button" id="b_mut_gauss" onclick="setMutation('gauss')">Gaussian</div>
            <div class="button" id="b_mut_soft" onclick="setMutation('soft')">Soft</div>
            <div class="button" id="b_mut_med" onclick="setMutation('medium')">Medium</div>
            <div class="button" id="b_mut_hard" onclick="setMutation('hard')">Hard</div>
        </div>

        <div id="resetdna">
            <div class="parname">Initialize DNA</div>
            <div class="button" id="b_dna_random" onclick="setDnaRandom()">Color</div>
            <div class="button" id="b_dna_white" onclick="setDnaColor(254,254,254)">White</div>
            <div class="button" id="b_dna_black" onclick="setDnaColor(0,0,0)">Black</div>
        </div>

        <div id="geometry">
            <div class="button" onclick="removePolygon()">-</div> <div class="button" onclick="addPolygon()">+</div> <span class="parname pargeo"><span id="polygons">50</span> Polygons</span> <br/>
            <div class="button" onclick="removeVertex()">-</div> <div class="button" onclick="addVertex()">+</div> <span class="parname pargeo"><span id="vertices">6</span> Vertices</span>
        </div>
    </div>

    <br class="clr"/>

    <!----------- YOU CAN CUT AWAY ANYTHING BELOW HERE IF YOU WANT JUST THE ALGORITHM (INCLUDING ITS USER INTERFACE) -------------->

    <div id="text">

    <h2>What is this?</h2>

    A <a href="http://en.wikipedia.org/wiki/Simulated_Annealing">simulated annealing</a> like optimization algorithm, a reimplementation of
    <a href="http://rogeralsing.com/2008/12/07/genetic-programming-evolution-of-mona-lisa/">Roger Alsing's excellent idea</a>.

    <div id="algo">
        The goal is to get an <b>image represented as a collection of overlapping polygons of various colors and transparencies</b>.

        <p>We start from random 50 polygons that are invisible. In each optimization step we randomly modify one parameter
        (like color components or polygon vertices) and check whether such new variant looks more like the original image.
        If it is, we keep it, and continue to mutate this one instead.

        <p><strike>Fitness is a sum of pixel-by-pixel differences from the original image. Lower number is better.</strike><br/>
        Displayed fitness is now a percentage of how close the new image is to the original one (1-current difference/maximum difference). The best possible is 100%.
        This new fitness is normalized so that it's easier to compare different images and different sizes.
    </div>

    <p>This implementation is based on Roger Alsing's description, though not on his code. There are probably some subtle differences
    in how the mutations are done, how the polygons are represented and how the fitness is computed as I tried to figure out how to
    have it running reasonably fast in JavaScript + &lt;canvas&gt; environment.

    <h2>How does it look after some time?</h2>
    <div class="snapshot">
        <img src="img/4points15min.jpg"/>
        <ul>
            <li>50 polygons (4-vertex)</li>
            <li>~15 minutes</li>
            <li>644 benefitial mutations</li>
            <li>6,120 candidates</li>
            <li>88.74% fitness</li>
        </ul>
    </div>
    <div class="snapshot">
        <img src="img/6points15min.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>~15 minutes</li>
            <li>646 benefitial mutations</li>
            <li>6,024 candidates</li>
            <li>89.04% fitness</li>
        </ul>
    </div>
    <div class="snapshot">
        <img src="img/10points15min.jpg"/>
        <ul>
            <li>50 polygons (10-vertex)</li>
            <li>~15 minutes</li>
            <li>645 benefitial mutations</li>
            <li>5,367 candidates</li>
            <li>87.01% fitness</li>
        </ul>
    </div>

    <br class="clr"/>
    <br class="clr"/>

    <div class="snapshot">
        <img src="img/6points45min.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>~45 minutes</li>
            <li>1,476 benefitial mutations</li>
            <li>23,694 candidates</li>
            <li>93.35% fitness</li>
        </ul>
    </div>

    <div class="snapshot">
        <img src="img/6points60min.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>~60 minutes</li>
            <li>1,595 benefitial mutations</li>
            <li>28,888 candidates</li>
            <li>93.46% fitness</li>
        </ul>
    </div>

    <div class="snapshot">
        <img src="img/6points120min.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>~120 minutes</li>
            <li>1,966  benefitial mutations</li>
            <li>50,500 candidates</li>
            <li>93.89% fitness</li>
        </ul>
    </div>

    <br class="clr"/>
    <br class="clr"/>

    <div class="snapshot">
        <img src="img/mona_9559.png"/>
        <ul style="margin-top:-0.5em">
            <li>50 polygons (6-vertex)</li>
            <li>~4 hours</li>
            <li>4,134 benefitial mutations</li>
            <li>807,890 candidates</li>
            <li>95.59% fitness</li>
            <li><small>Thanks to Sergei.</small></li>
        </ul>
    </div>

    <div class="snapshot">
        <img src="img/mona_9636.png"/>
        <ul style="margin-top:-0.5em">
            <li>50 polygons (6-vertex)</li>
            <li>~2 days</li>
            <li>7,425 benefitial mutations</li>
            <li>5,288,801 candidates</li>
            <li>96.36% fitness</li>
            <li><small>Thanks to Julian.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <h2>Does it work on all images?</h2>

    It depends, success varies. The best seem to be color images with well defined features.
    <br/>
    <br/>

    <div class="snapshot">
        <img src="img/darwin_tiny.jpg" style="margin-right:0.25em"/>
        <img src="img/6points15min-darwin.jpg"/>
        <img src="img/6points60min-darwin.jpg"/>
        <img src="img/darwin_9597.png"/>
        <ul style="margin-top:-0.5em">
            <li>50 polygons (6-vertex)</li>
            <li>4,358 benefitial mutations</li>
            <li>227,852 candidates</li>
            <li>95.97% fitness</li>
            <li><small>Thanks to Quialiss.</small></li>
            <li><small>Images from different runs.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/velociraptor_tiny.jpg" style="margin-right:0.25em"/>
        <img src="img/6points15min-velociraptor.jpg"/>
        <img src="img/6points60min-velociraptor.jpg"/>
        <img src="img/velociraptor_9524.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>718+ benefitial mutations</li>
            <li>22,440+ candidates</li>
            <li>95.24% fitness</li>
            <li><small>Images from different runs.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/velociraptor_9612_100p.jpg" style="margin-left:200px"/>
        <ul>
            <li>100 polygons (6-vertex)</li>
            <li>9,686 benefitial mutations</li>
            <li>1,220,569 candidates</li>
            <li>96.21% fitness</li>
            <li><small>Thanks to Steven.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/firefox_tiny.jpg" style="margin-right:0.25em"/>
        <img src="img/firefox_9476.png"/>
        <img src="img/firefox_9568.png"/>
        <img src="img/firefox_9503.png"/>
        <ul>
            <li>100 polygons (5-vertex)</li>
            <li>10,490 benefitial mutations</li>
            <li>2,161,018 candidates</li>
            <li>95.03% fitness</li>
            <li><small>Thanks to <a href="http://news.ycombinator.com/item?id=393998">Asa</a>, Will, Nic &amp; Yuku.</small></li>
            <li><small>Images from different runs.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/mondrian_tiny.jpg" style="margin-right:0.25em"/>
        <img src="img/mondrian_2991784x.jpg"/>
        <img src="img/mondrian_75485924.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>6,280 benefitial mutations</li>
            <li>683,806 candidates</li>
            <li><small>Thanks to <a href="http://www.reddit.com/r/programming/comments/7iglm/evolution_of_mona_lisa_in_javascript_canvas_use/c06r7m9">alexs</a> for the final image.</small></li>
            <li><small>Images from different runs.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/opera_9568.png"/>
        <ul style="margin-top:0.0em">
            <li>100 polygons (5-vertex)</li>
            <li>6,974 benefitial mutations</li>
            <li>2,056,467  candidates</li>
            <li>95.68% fitness</li>
            <li><small>Thanks to Yuku.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/apple.png"/>
        <ul style="margin-top:0.0em">
            <li>100 polygons (6-vertex)</li>
            <li>6,557 benefitial mutations</li>
            <li>44,212,346 candidates</li>
            <li>99.43% fitness</li>
            <li><small>Thanks to Alex.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/cube.jpg" style="margin-right:0.25em"/>
        <img src="img/cube_504973.jpg"/>
        <ul style="margin-top:0.5em">
            <li>50 polygons (6-vertex)</li>
            <li>4,296 benefitial mutations</li>
            <li>2,404,942 candidates</li>
            <li>97.6% fitness</li>
            <li><small>Thanks to <a href="http://teque5.com">Kyle</a>.</small></li>
        </ul>
    </div>

    <br class="clr"/>


    <div class="snapshot">
        <img src="img/krhainos.gif" style="margin-right:0.25em"/>
        <img src="img/krhainos_9384.jpg"/>
        <ul>
            <li>50 polygons (6-vertex)</li>
            <li>10,605 benefitial mutations</li>
            <li>11,104,153 candidates</li>
            <li>93.84% fitness</li>
            <li><small>Thanks to <a href="http://dingo9.net">KRHAiNOS</a>.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <div class="snapshot">
        <img src="img/firefox_9504.png"/>
        <ul style="margin-top:0.0em">
            <li>50 polygons (6-vertex)</li>
            <li>11,147 benefitial mutations</li>
            <li>1,021,165 candidates</li>
            <li>95.04% fitness</li>
            <li><small>Thanks to Simon.</small></li>
        </ul>
    </div>

    <br class="clr"/>

    <small>See also <a href="http://video.google.com/videoplay?docid=-3161308595667510942">Firefox logo evolution video</a>. Thanks to Brooss.</small>

    <br class="clr"/>
    <br/>

    <div class="snapshot wide">
        <img src="img/tanaka-reina-small.jpg"/>
        <ul style="margin-top:0.0em">
            <li>Distributed computing effort: original image size 600px X 900px, divided into 24 parts each 150px X 150px</li>
            <li>24 x 100 polygons (6-vertex)</li>
            <li>109,438+ benefitial mutations (total)</li>
            <li>8,243,441+ candidates (total)</li>
            <li>Fitness: min 95.01%, max 99.08%, mean 96.59%, median 96.65%</li>
            <li><small>Thanks to Agro <a href="http://momusuindo.net">momusuindo.net</a> (Indonesia).</small></li>
            <li><small><a href="tanaka-reina-full-credits.jpg">Full resolution final image</a></small></li>
        </ul>
    </div>

    <br class="clr"/>
    <br/>

    <div class="snapshot wide">
        <img src="img/Velazquez_Diego_Bacchus-small.jpg" style="margin-right:0.25em;"/>
        <img src="img/velasquez-small.jpg"/>
         <br class="clr"/>
        <ul style="margin:0.5em 0 0 0; padding:0 0 0 1em; float:none">
            <li>Multiple 50-polygon pieces, exported to SVG, joined in Illustrator</li>
            <li><small>Thanks to <a href="http://www.escena.ya.com/bitofart">Antonio Ares</a>.</small></li>
            <li><small><a href="velasquez-full.jpg">Full resolution final image</a></small></li>
        </ul>
    </div>

    <br class="clr"/>

    <h2 id="export_note">What is DNA import/export?</h2>

    <span class="warning">Warning: Another experimental <strike>(that is not tested at all)</strike> feature. Most of the bugs should be fixed now.</span>

    <p>Click <b>Export DNA</b> to copy polygon representation of the current best image to the clipboard. You can use it to save your optimization state,
    for example to send it to somebody by mail or post it on the web.

    <p>If you have such saved DNA string, you can later on paste it into the clipboard and click on <b>Import DNA</b>. This should reproduce the optimization state
    from the time it was saved via export.

    <p>Please note that DNA is independent of the original image. It means that if you used a custom image, you should also set this image (via image form) to reproduce
    a complete state. (Or you could play with switching images/DNA midway)

    <div id="dnaformat">
    DNA format is very simple (all numbers are INTs except for ALPHA which is FLOAT):
    <pre>NUMBER_OF_VERTICES NUMBER_OF_POLYGONS R G B ALPHA X0 Y0 X1 Y1 ... XN YN ... R G B ALPHA X0 Y0 X1 Y1 ... XN YN ...</pre>
    </div>

    <p>Click <b>Export DNA as SVG</b> to get <a href="http://en.wikipedia.org/wiki/Scalable_Vector_Graphics">vector image</a> from your current best DNA.
    Thanks to <a href="http://www.breidt.net/">Martin</a> for SVG export.

    <h2>Requirements</h2>

    <p>Tested and works on (example mutations / second speed for Mona Lisa at the start of optimization on my notebook):
    <ul style="color:green">
		<li><span class="speed">(~221)</span> Chrome 15</li>
		<li><span class="speed">(~142)</span> Firefox 11 nightly</li>
		<li><span class="speed">(~119)</span> Internet Explorer 9</li>
		<li><span class="speed">(~97)</span> Opera 11.52</li>
		<li><span class="speed">(~60)</span> Firefox 8</li>
		<li><span class="speed">(~60)</span> Chrome 17 canary</li>
		<li><span class="speed">(~51)</span> Opera 12.00 alpha</li>
    </ul>

    </div>

    <h2>Frequently asked questions</h2>

    <dl>

    <dt>[Q] I want to play with the algorithm, but my local copy doesn't want to run. What should I do?</dt>
    <dd>[A] The problem is JavaScript's <a href="http://en.wikipedia.org/wiki/Same_origin_policy">same origin security policy</a>.
    You must access the page via local webserver using <b>http://localhost</b> instead of just <b>file://</b>.
    You can use for example Apache from <a href="http://en.wikipedia.org/wiki/Xampp">XAMPP</a>.

    <p>Then it would still work just on local images (located at the same server, access via "http://"). If you want to access images from remote sites, you need to work around,
    for example by creating a proxy, so that images would be coming from your server. <a href="http://sk.php.net/manual/en/function.curl-init.php">PHP Curl</a> is one possible way
    how to do a simple proxy.
    </dd>

    <dt>[Q] How do I compute a new fitness from the old one?</dt>
    <dd>[A] new fitness = 100 * (1 - old fitness / (width*height*3*255))
    </dd>

    <dt>[Q] Can I have a compiled version to run it really fast on my computer locally?</dt>
    <dd>[A] You can download Roger Alsing's <a href="http://rogeralsing.com/2008/12/11/genetic-programming-mona-lisa-source-code-and-binaries/">original binaries and C# sources</a>.
    Also there is a <a href="http://github.com/mackstann/mona/tree/master">C version for Linux</a> by Nick Welch.
    </dd>

    <dt>[Q] What are different mutations?</dt>
    <dd>
    <ul>
        <li><b>Soft</b> mutations change exactly one parameter (R, G, B, A, X, Y) by a small delta.</li>
        <li><b>Medium</b> mutations change exactly one parameter to a completely random number.</li>
        <li><b>Hard</b> mutations change a color and transparency of one polygon to a completely random value together with changing one vertex to a completely random point.</li>
        <li><b>Gaussian</b> mutations change one parameter by delta picked from <a href="http://en.wikipedia.org/wiki/Normal_Distribution">normal distribution</a> of values around the current value.
        Thanks to <a href="http://www.blamestar.de">Fritz</a> for Gaussian mutations.
        </li>
    </dd>

    </dl>

    <h2>Contact</h2>

	Source at <a href="https://github.com/alteredq/evolve">GitHub</a>.

    If you have any questions, suggestions, comments, you can send me a <a href="mailto:postfilter@gmail.com">mail</a>.

    Or you can check <a href="http://news.ycombinator.com/item?id=392036">Hacker News</a> or
    <a href="http://www.reddit.com/r/programming/comments/7iglm/evolution_of_mona_lisa_in_javascript_canvas_use/">Reddit</a> comments for this page.

    Also I'm on Twitter as <a href="http://twitter.com/alteredq">@alteredq</a>.

    <p>Feel free to improve on my implementation. The code is rather ugly, though some ugliness is there for performance reasons.

    <p>Source is released under <a href="http://en.wikipedia.org/wiki/Mit_license">MIT License</a>.


 </body>
</html>
